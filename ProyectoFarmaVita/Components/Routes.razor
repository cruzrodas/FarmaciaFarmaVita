@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Navigation

<CascadingAuthenticationState>
    <Router AppAssembly="@typeof(Program).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(Layout.MainLayout)">
                <NotAuthorized>
                    <AuthorizeView>
                        <Authorized Context="auth">
                            <!-- Usuario autenticado pero sin permisos para esta página específica -->
                            <div class="access-denied-container">
                                <div class="access-denied-content">
                                    <i class="fas fa-lock access-denied-icon"></i>
                                    <h1>Acceso Denegado</h1>
                                    <p>No tienes permisos para acceder a esta página del sistema FarmaVita.</p>
                                    <p>Tu rol actual no te permite ver este contenido.</p>
                                    <MudButton Variant="Variant.Filled"
                                               Color="Color.Primary"
                                               Href="/"
                                               StartIcon="@Icons.Material.Filled.Home"
                                               Class="mt-3">
                                        Volver al inicio
                                    </MudButton>
                                </div>
                            </div>
                        </Authorized>
                        <NotAuthorized Context="auth">
                            <!-- Usuario no autenticado - mostrar página de login -->
                            <div class="loading-container">
                                <div class="loading-content">
                                    <MudProgressCircular Size="Size.Large" Indeterminate="true" Color="Color.Primary" />
                                    <MudImage Src="images/Logo FarmaVita.png"
                                              Width="120"
                                              Height="120"
                                              Alt="FarmaVita Logo"
                                              Class="mt-4 pulse-img" />
                                    <p class="mt-3">Redirigiendo al login...</p>
                                </div>
                            </div>
                            <script>
                                setTimeout(function() {
                                    window.location.href = '/login';
                                }, 1000);
                            </script>
                        </NotAuthorized>
                    </AuthorizeView>
                </NotAuthorized>
                <Authorizing>
                    <div class="loading-container">
                        <div class="loading-content">
                            <MudProgressCircular Size="Size.Large" Indeterminate="true" Color="Color.Primary" />
                            <MudImage Src="images/Logo FarmaVita.png"
                                      Width="120"
                                      Height="120"
                                      Alt="FarmaVita Logo"
                                      Class="mt-4 pulse-img" />
                            <p class="mt-3">Verificando permisos...</p>
                        </div>
                    </div>
                </Authorizing>
            </AuthorizeRouteView>
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>
        <NotFound>
            <LayoutView Layout="@typeof(Layout.MainLayout)">
                <div class="not-found-container">
                    <div class="not-found-content">
                        <i class="fas fa-capsules not-found-icon"></i>
                        <h1>404 - Página no encontrada</h1>
                        <p>Lo sentimos, la página que buscas no existe en el sistema FarmaVita.</p>
                        <p>Verifica la URL o navega desde el menú principal.</p>
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Primary"
                                   Href="/"
                                   StartIcon="@Icons.Material.Filled.Home"
                                   Class="mt-3">
                            Volver al inicio
                        </MudButton>
                    </div>
                </div>
            </LayoutView>
        </NotFound>
    </Router>
</CascadingAuthenticationState>